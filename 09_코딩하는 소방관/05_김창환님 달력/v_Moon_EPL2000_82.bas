Attribute VB_Name = "v_Moon_EPL2000_82"
Option Explicit

'달의 위치 계산(거리는 km)
Sub MoonLBR(ByVal JDE As Double, l As Double, B As Double, R As Double)
  Dim T As Double, L1 As Double, D As Double, M As Double, M1 As Double, f As Double, A1 As Double, A2 As Double, A3 As Double
  Dim E As Double, T2 As Double, T3 As Double, T4 As Double
  Dim SL As Double, SB As Double, SR As Double, i As Long
  Dim AD(60) As Double, AM(60) As Double, am1(60) As Double, af(60) As Double
  Dim ad1(60) As Double, am1a(60) As Double, am11(60) As Double, af1(60) As Double
  Dim cl(60) As Double, cr(60) As Double, cb(60) As Double, a As Double, E2 As Double, k  As Double
  
  Call InputData(AD, AM, am1, af, ad1, am1a, am11, af1, cl, cr, cb)
  
  T = (JDE - 2451545) / 36525
  T2 = T * T: T3 = T2 * T: T4 = T2 * T2
  
  L1 = 218.3164477 + 481267.88123421 * T - 0.0015786 * T2 + T3 / 538841 - T4 / 65194000
  D = 297.8501921 + 445267.1114034 * T - 0.0018819 * T2 + T3 / 545868 - T4 / 113065000
  M = 357.5291092 + 35999.0502909 * T - 0.0001536 * T2 + T3 / 24490000
  M1 = 134.9633964 + 477198.8675055 * T + 0.0087414 * T2 + T3 / 69699 - T4 / 14712000
  f = 93.272095 + 483202.0175233 * T - 0.0036539 * T2 - T3 / 3526000 + T4 / 863310000
  A1 = 119.75 + 131.849 * T
  A2 = 53.09 + 479264.29 * T
  A3 = 313.45 + 481266.484 * T
  E = 1 - 0.002516 * T - 0.0000074 * T2: E2 = E * E
  
  L1 = Rev(L1): D = Rev(D): M = Rev(M): M1 = Rev(M1): f = Rev(f): A1 = Rev(A1): A2 = Rev(A2): A3 = Rev(A3)
  
  SL = 0: SR = 0: SB = 0
  For i = 1 To 60
    k = 1
    If Abs(AM(i)) = 1 Then
      k = E
    ElseIf Abs(AM(i)) = 2 Then
      k = E2
    End If
    
    a = (AD(i) * D + AM(i) * M + am1(i) * M1 + af(i) * f) * DegtoRad
    SL = SL + cl(i) * Sin(a) * k: SR = SR + cr(i) * Cos(a) * k
    
    k = 1
    If Abs(am1a(i)) = 1 Then
      k = E
    ElseIf Abs(am1a(i)) = 2 Then
      k = E2
    End If

    a = Rev(ad1(i) * D + am1a(i) * M + am11(i) * M1 + af1(i) * f) * DegtoRad
    SB = SB + cb(i) * Sin(a) * k
  Next i
  
  SL = SL + 3958 * Sind(A1) + 1962 * Sind(L1 - f) + 318 * Sind(A2)
  SB = SB - 2235 * Sind(L1) + 382 * Sind(A3) + 175 * Sind(A1 - f) + 175 * Sind(A1 + f) + 127 * Sind(L1 - M1) - 115 * Sind(L1 + M1)
  SR = SR
  
  l = Rev(L1 + SL / 1000000) * DegtoRad
  B = SB / 1000000 * DegtoRad
  R = 385000.56 + SR / 1000
End Sub

Private Sub InputData(D() As Double, M() As Double, M1() As Double, f() As Double, _
                                 D1() As Double, m1a() As Double, m11() As Double, F1() As Double, _
                                 cl() As Double, cr() As Double, cb() As Double)

  D(1) = 0: M(1) = 0: M1(1) = 1: f(1) = 0: cl(1) = 6288774: cr(1) = -20905355
  D(2) = 2: M(2) = 0: M1(2) = -1: f(2) = 0: cl(2) = 1274027: cr(2) = -3699111
  D(3) = 2: M(3) = 0: M1(3) = 0: f(3) = 0: cl(3) = 658314: cr(3) = -2955968
  D(4) = 0: M(4) = 0: M1(4) = 2: f(4) = 0: cl(4) = 213618: cr(4) = -569925
  D(5) = 0: M(5) = 1: M1(5) = 0: f(5) = 0: cl(5) = -185116: cr(5) = 48888
  D(6) = 0: M(6) = 0: M1(6) = 0: f(6) = 2: cl(6) = -114332: cr(6) = -3149
  D(7) = 2: M(7) = 0: M1(7) = -2: f(7) = 0: cl(7) = 58793: cr(7) = 246158
  D(8) = 2: M(8) = -1: M1(8) = -1: f(8) = 0: cl(8) = 57066: cr(8) = -152138
  D(9) = 2: M(9) = 0: M1(9) = 1: f(9) = 0: cl(9) = 53322: cr(9) = -170733
  D(10) = 2: M(10) = -1: M1(10) = 0: f(10) = 0: cl(10) = 45758: cr(10) = -204586
  D(11) = 0: M(11) = 1: M1(11) = -1: f(11) = 0: cl(11) = -40923: cr(11) = -129620
  D(12) = 1: M(12) = 0: M1(12) = 0: f(12) = 0: cl(12) = -34720: cr(12) = 108743
  D(13) = 0: M(13) = 1: M1(13) = 1: f(13) = 0: cl(13) = -30383: cr(13) = 104755
  D(14) = 2: M(14) = 0: M1(14) = 0: f(14) = -2: cl(14) = 15327: cr(14) = 10321
  D(15) = 0: M(15) = 0: M1(15) = 1: f(15) = 2: cl(15) = -12528: cr(15) = 0
  D(16) = 0: M(16) = 0: M1(16) = 1: f(16) = -2: cl(16) = 10980: cr(16) = 79661
  D(17) = 4: M(17) = 0: M1(17) = -1: f(17) = 0: cl(17) = 10675: cr(17) = -34782
  D(18) = 0: M(18) = 0: M1(18) = 3: f(18) = 0: cl(18) = 10034: cr(18) = -23210
  D(19) = 4: M(19) = 0: M1(19) = -2: f(19) = 0: cl(19) = 8548: cr(19) = -21636
  D(20) = 2: M(20) = 1: M1(20) = -1: f(20) = 0: cl(20) = -7888: cr(20) = 24208
  D(21) = 2: M(21) = 1: M1(21) = 0: f(21) = 0: cl(21) = -6766: cr(21) = 30824
  D(22) = 1: M(22) = 0: M1(22) = -1: f(22) = 0: cl(22) = -5163: cr(22) = -8379
  D(23) = 1: M(23) = 1: M1(23) = 0: f(23) = 0: cl(23) = 4987: cr(23) = -16675
  D(24) = 2: M(24) = -1: M1(24) = 1: f(24) = 0: cl(24) = 4036: cr(24) = -12831
  D(25) = 2: M(25) = 0: M1(25) = 2: f(25) = 0: cl(25) = 3994: cr(25) = -10445
  D(26) = 4: M(26) = 0: M1(26) = 0: f(26) = 0: cl(26) = 3861: cr(26) = -11650
  D(27) = 2: M(27) = 0: M1(27) = -3: f(27) = 0: cl(27) = 3665: cr(27) = 14403
  D(28) = 0: M(28) = 1: M1(28) = -2: f(28) = 0: cl(28) = -2689: cr(28) = -7003
  D(29) = 2: M(29) = 0: M1(29) = -1: f(29) = 2: cl(29) = -2602: cr(29) = 0
  D(30) = 2: M(30) = -1: M1(30) = -2: f(30) = 0: cl(30) = 2390: cr(30) = 10056
  D(31) = 1: M(31) = 0: M1(31) = 1: f(31) = 0: cl(31) = -2348: cr(31) = 6322
  D(32) = 2: M(32) = -2: M1(32) = 0: f(32) = 0: cl(32) = 2236: cr(32) = -9884
  D(33) = 0: M(33) = 1: M1(33) = 2: f(33) = 0: cl(33) = -2120: cr(33) = 5751
  D(34) = 0: M(34) = 2: M1(34) = 0: f(34) = 0: cl(34) = -2069: cr(34) = 0
  D(35) = 2: M(35) = -2: M1(35) = -1: f(35) = 0: cl(35) = 2048: cr(35) = -4950
  D(36) = 2: M(36) = 0: M1(36) = 1: f(36) = -2: cl(36) = -1773: cr(36) = 4130
  D(37) = 2: M(37) = 0: M1(37) = 0: f(37) = 2: cl(37) = -1595: cr(37) = 0
  D(38) = 4: M(38) = -1: M1(38) = -1: f(38) = 0: cl(38) = 1215: cr(38) = -3958
  D(39) = 0: M(39) = 0: M1(39) = 2: f(39) = 2: cl(39) = -1110: cr(39) = 0
  D(40) = 3: M(40) = 0: M1(40) = -1: f(40) = 0: cl(40) = -892: cr(40) = 3258
  D(41) = 2: M(41) = 1: M1(41) = 1: f(41) = 0: cl(41) = -810: cr(41) = 2616
  D(42) = 4: M(42) = -1: M1(42) = -2: f(42) = 0: cl(42) = 759: cr(42) = -1897
  D(43) = 0: M(43) = 2: M1(43) = -1: f(43) = 0: cl(43) = -713: cr(43) = -2117
  D(44) = 2: M(44) = 2: M1(44) = -1: f(44) = 0: cl(44) = -700: cr(44) = 2354
  D(45) = 2: M(45) = 1: M1(45) = -2: f(45) = 0: cl(45) = 691: cr(45) = 0
  D(46) = 2: M(46) = -1: M1(46) = 0: f(46) = -2: cl(46) = 596: cr(46) = 0
  D(47) = 4: M(47) = 0: M1(47) = 1: f(47) = 0: cl(47) = 549: cr(47) = -1423
  D(48) = 0: M(48) = 0: M1(48) = 4: f(48) = 0: cl(48) = 537: cr(48) = -1117
  D(49) = 4: M(49) = -1: M1(49) = 0: f(49) = 0: cl(49) = 520: cr(49) = -1571
  D(50) = 1: M(50) = 0: M1(50) = -2: f(50) = 0: cl(50) = -487: cr(50) = -1739
  D(51) = 2: M(51) = 1: M1(51) = 0: f(51) = -2: cl(51) = -399: cr(51) = 0
  D(52) = 0: M(52) = 0: M1(52) = 2: f(52) = -2: cl(52) = -381: cr(52) = -4421
  D(53) = 1: M(53) = 1: M1(53) = 1: f(53) = 0: cl(53) = 351: cr(53) = 0
  D(54) = 3: M(54) = 0: M1(54) = -2: f(54) = 0: cl(54) = -340: cr(54) = 0
  D(55) = 4: M(55) = 0: M1(55) = -3: f(55) = 0: cl(55) = 330: cr(55) = 0
  D(56) = 2: M(56) = -1: M1(56) = 2: f(56) = 0: cl(56) = 327: cr(56) = 0
  D(57) = 0: M(57) = 2: M1(57) = 1: f(57) = 0: cl(57) = -323: cr(57) = 1165
  D(58) = 1: M(58) = 1: M1(58) = -1: f(58) = 0: cl(58) = 299: cr(58) = 0
  D(59) = 2: M(59) = 0: M1(59) = 3: f(59) = 0: cl(59) = 294: cr(59) = 0
  D(60) = 2: M(60) = 0: M1(60) = -1: f(60) = -2: cl(60) = 0: cr(60) = 8752

  D1(1) = 0: m1a(1) = 0: m11(1) = 0: F1(1) = 1: cb(1) = 5128122
  D1(2) = 0: m1a(2) = 0: m11(2) = 1: F1(2) = 1: cb(2) = 280602
  D1(3) = 0: m1a(3) = 0: m11(3) = 1: F1(3) = -1: cb(3) = 277693
  D1(4) = 2: m1a(4) = 0: m11(4) = 0: F1(4) = -1: cb(4) = 173237
  D1(5) = 2: m1a(5) = 0: m11(5) = -1: F1(5) = 1: cb(5) = 55413
  D1(6) = 2: m1a(6) = 0: m11(6) = -1: F1(6) = -1: cb(6) = 46271
  D1(7) = 2: m1a(7) = 0: m11(7) = 0: F1(7) = 1: cb(7) = 32573
  D1(8) = 0: m1a(8) = 0: m11(8) = 2: F1(8) = 1: cb(8) = 17198
  D1(9) = 2: m1a(9) = 0: m11(9) = 1: F1(9) = -1: cb(9) = 9266
  D1(10) = 0: m1a(10) = 0: m11(10) = 2: F1(10) = -1: cb(10) = 8822
  D1(11) = 2: m1a(11) = -1: m11(11) = 0: F1(11) = -1: cb(11) = 8216
  D1(12) = 2: m1a(12) = 0: m11(12) = -2: F1(12) = -1: cb(12) = 4324
  D1(13) = 2: m1a(13) = 0: m11(13) = 1: F1(13) = 1: cb(13) = 4200
  D1(14) = 2: m1a(14) = 1: m11(14) = 0: F1(14) = -1: cb(14) = -3359
  D1(15) = 2: m1a(15) = -1: m11(15) = -1: F1(15) = 1: cb(15) = 2463
  D1(16) = 2: m1a(16) = -1: m11(16) = 0: F1(16) = 1: cb(16) = 2211
  D1(17) = 2: m1a(17) = -1: m11(17) = -1: F1(17) = -1: cb(17) = 2065
  D1(18) = 0: m1a(18) = 1: m11(18) = -1: F1(18) = -1: cb(18) = -1870
  D1(19) = 4: m1a(19) = 0: m11(19) = -1: F1(19) = -1: cb(19) = 1828
  D1(20) = 0: m1a(20) = 1: m11(20) = 0: F1(20) = 1: cb(20) = -1794
  D1(21) = 0: m1a(21) = 0: m11(21) = 0: F1(21) = 3: cb(21) = -1749
  D1(22) = 0: m1a(22) = 1: m11(22) = -1: F1(22) = 1: cb(22) = -1565
  D1(23) = 1: m1a(23) = 0: m11(23) = 0: F1(23) = 1: cb(23) = -1491
  D1(24) = 0: m1a(24) = 1: m11(24) = 1: F1(24) = 1: cb(24) = -1475
  D1(25) = 0: m1a(25) = 1: m11(25) = 1: F1(25) = -1: cb(25) = -1410
  D1(26) = 0: m1a(26) = 1: m11(26) = 0: F1(26) = -1: cb(26) = -1344
  D1(27) = 1: m1a(27) = 0: m11(27) = 0: F1(27) = -1: cb(27) = -1335
  D1(28) = 0: m1a(28) = 0: m11(28) = 3: F1(28) = 1: cb(28) = 1107
  D1(29) = 4: m1a(29) = 0: m11(29) = 0: F1(29) = -1: cb(29) = 1021
  D1(30) = 4: m1a(30) = 0: m11(30) = -1: F1(30) = 1: cb(30) = 833
  D1(31) = 0: m1a(31) = 0: m11(31) = 1: F1(31) = -3: cb(31) = 777
  D1(32) = 4: m1a(32) = 0: m11(32) = -2: F1(32) = 1: cb(32) = 671
  D1(33) = 2: m1a(33) = 0: m11(33) = 0: F1(33) = -3: cb(33) = 607
  D1(34) = 2: m1a(34) = 0: m11(34) = 2: F1(34) = -1: cb(34) = 596
  D1(35) = 2: m1a(35) = -1: m11(35) = 1: F1(35) = -1: cb(35) = 491
  D1(36) = 2: m1a(36) = 0: m11(36) = -2: F1(36) = 1: cb(36) = -451
  D1(37) = 0: m1a(37) = 0: m11(37) = 3: F1(37) = -1: cb(37) = 439
  D1(38) = 2: m1a(38) = 0: m11(38) = 2: F1(38) = 1: cb(38) = 422
  D1(39) = 2: m1a(39) = 0: m11(39) = -3: F1(39) = -1: cb(39) = 421
  D1(40) = 2: m1a(40) = 1: m11(40) = -1: F1(40) = 1: cb(40) = -366
  D1(41) = 2: m1a(41) = 1: m11(41) = 0: F1(41) = 1: cb(41) = -351
  D1(42) = 4: m1a(42) = 0: m11(42) = 0: F1(42) = 1: cb(42) = 331
  D1(43) = 2: m1a(43) = -1: m11(43) = 1: F1(43) = 1: cb(43) = 315
  D1(44) = 2: m1a(44) = -2: m11(44) = 0: F1(44) = -1: cb(44) = 302
  D1(45) = 0: m1a(45) = 0: m11(45) = 1: F1(45) = 3: cb(45) = -283
  D1(46) = 2: m1a(46) = 1: m11(46) = 1: F1(46) = -1: cb(46) = -229
  D1(47) = 1: m1a(47) = 1: m11(47) = 0: F1(47) = -1: cb(47) = 223
  D1(48) = 1: m1a(48) = 1: m11(48) = 0: F1(48) = 1: cb(48) = 223
  D1(49) = 0: m1a(49) = 1: m11(49) = -2: F1(49) = -1: cb(49) = -220
  D1(50) = 2: m1a(50) = 1: m11(50) = -1: F1(50) = -1: cb(50) = -220
  D1(51) = 1: m1a(51) = 0: m11(51) = 1: F1(51) = 1: cb(51) = -185
  D1(52) = 2: m1a(52) = -1: m11(52) = -2: F1(52) = -1: cb(52) = 181
  D1(53) = 0: m1a(53) = 1: m11(53) = 2: F1(53) = 1: cb(53) = -177
  D1(54) = 4: m1a(54) = 0: m11(54) = -2: F1(54) = -1: cb(54) = 176
  D1(55) = 4: m1a(55) = -1: m11(55) = -1: F1(55) = -1: cb(55) = 166
  D1(56) = 1: m1a(56) = 0: m11(56) = 1: F1(56) = -1: cb(56) = -164
  D1(57) = 4: m1a(57) = 0: m11(57) = 1: F1(57) = -1: cb(57) = 132
  D1(58) = 1: m1a(58) = 0: m11(58) = -1: F1(58) = -1: cb(58) = -119
  D1(59) = 4: m1a(59) = -1: m11(59) = 0: F1(59) = -1: cb(59) = 115
  D1(60) = 2: m1a(60) = -2: m11(60) = 0: F1(60) = 1: cb(60) = 107
End Sub
